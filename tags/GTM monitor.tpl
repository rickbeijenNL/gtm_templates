___TERMS_OF_SERVICE___

By creating or modifying this file you agree to Google Tag Manager's Community
Template Gallery Developer Terms of Service available at
https://developers.google.com/tag-manager/gallery-tos (or such other URL as
Google may provide), as modified from time to time.


___INFO___

{
  "type": "TAG",
  "id": "cvt_temp_public_id",
  "version": 1,
  "securityGroups": [],
  "displayName": "GTM monitor",
  "brand": {
    "id": "brand_dummy",
    "displayName": "",
    "thumbnail": "data:image/png;base64,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"
  },
  "description": "GTM tag monitor by rickbeijen.nl.",
  "containerContexts": [
    "WEB"
  ]
}


___TEMPLATE_PARAMETERS___

[
  {
    "type": "RADIO",
    "name": "batchHits",
    "displayName": "If you select No, details of all the tags that fired for any given hit are sent in a single GET request. If you select Yes, you can choose the maximum number of tags per request, and the tag will automatically send multiple requests if necessary.",
    "radioItems": [
      {
        "value": "no",
        "displayValue": "No"
      },
      {
        "value": "yes",
        "displayValue": "Yes",
        "subParams": [
          {
            "type": "TEXT",
            "name": "maxTags",
            "displayName": "Maximum number of tags per request",
            "simpleValueType": true,
            "help": "Enter the maximum number of tags per request that will be dispatched to the endpoint. If necessary, multiple requests will be made.",
            "defaultValue": 10,
            "valueValidators": [
              {
                "type": "POSITIVE_NUMBER"
              }
            ]
          }
        ]
      }
    ],
    "simpleValueType": true
  }
]


___SANDBOXED_JS_FOR_WEB_TEMPLATE___

// Require the necessary APIs
const addEventCallback = require('addEventCallback');
const readFromDataLayer = require('copyFromDataLayer');
const sendPixel = require('sendPixel');
const getTimestamp = require('getTimestamp');

// Get the dataLayer event that triggered the tag
const event = readFromDataLayer('event');

// Add a timestamp to separate events named the same way from each other
const eventTimestamp = getTimestamp();

const endPoint = 'https://europe-west4-rb-gtm-monitoring.cloudfunctions.net/gtm_monitor';
const batchHits = data.batchHits === 'yes';
const maxTags = data.maxTags;

// Utility for splitting an array into multiple arrays of given size
const splitToBatches = (arr, size) => {
  const newArr = [];
  for (let i = 0, len = arr.length; i < len; i += size) {
    newArr.push(arr.slice(i, i + size));
  }
  return newArr;
};

// The addEventCallback gets two arguments: container ID and a data object with an array of tags that fired
addEventCallback((ctid, eventData) => {

  // Filter out tags that have the "exclude" metadata set to true
  const tags = eventData.tags.filter(t => t.exclude !== 'true' && t.status !== null && t.status !== 'success');
  
  // If batching is enabled, split the tags into batches of the given size
  const batches = batchHits ? splitToBatches(tags, maxTags) : [tags];
  
  // For each batch, build a payload and dispatch to the endpoint as a GET request
  batches.forEach(tags => {
    let payload = '?eventName=' + event + '&eventTimestamp=' + eventTimestamp + '&containerId=' + ctid;
    tags.forEach((tag, idx) => {
      const tagPrefix = '&tag' + (idx + 1);
      payload +=
        tagPrefix + 'id=' + tag.id +
        tagPrefix + 'nm=' + tag.name +
        tagPrefix + 'st=' + tag.status +
        tagPrefix + 'et=' + tag.executionTime;
    });
    sendPixel(endPoint + payload, null, null);
  });
});

// After adding the callback, signal tag completion
data.gtmOnSuccess();


___WEB_PERMISSIONS___

[
  {
    "instance": {
      "key": {
        "publicId": "read_event_metadata",
        "versionId": "1"
      },
      "param": []
    },
    "isRequired": true
  },
  {
    "instance": {
      "key": {
        "publicId": "read_data_layer",
        "versionId": "1"
      },
      "param": [
        {
          "key": "allowedKeys",
          "value": {
            "type": 1,
            "string": "specific"
          }
        },
        {
          "key": "keyPatterns",
          "value": {
            "type": 2,
            "listItem": [
              {
                "type": 1,
                "string": "event"
              }
            ]
          }
        }
      ]
    },
    "clientAnnotations": {
      "isEditedByUser": true
    },
    "isRequired": true
  },
  {
    "instance": {
      "key": {
        "publicId": "send_pixel",
        "versionId": "1"
      },
      "param": [
        {
          "key": "allowedUrls",
          "value": {
            "type": 1,
            "string": "specific"
          }
        },
        {
          "key": "urls",
          "value": {
            "type": 2,
            "listItem": [
              {
                "type": 1,
                "string": "https://europe-west4-rb-gtm-monitoring.cloudfunctions.net/gtm_monitor*"
              }
            ]
          }
        }
      ]
    },
    "clientAnnotations": {
      "isEditedByUser": true
    },
    "isRequired": true
  }
]


___TESTS___

scenarios: []


___NOTES___

Created on 26/07/2024, 17:15:36


